---
title: "Introduction to R 8-20-2020"
author: "Rob Wells"
date: "8/20/2020"
output: html_document
---

**Get Organized**    
    
    Create a folder on your Desktop: name it DataFall2020
    Store this file and the Census data in this folder


** You only run this once for the first setup
```{r}
#Example is below
#Put in your own directory
#setwd(/Users/rswells/Dropbox/Classes/Data Fall 2020/CovidFall2020)
```


```{r}
#This aligns the file with a directory and saves a huge hassle
install.packages("here")
library(here)
```

---    

###  Orientation about R Studio  

**There are four main windows**  

    Script writing, R Markdown, Table Viewer: Upper Left  
    Environment - data loaded in R: Upper Right  
    Console - write commands in R: Lower Left  
    File Manager and Html table viewer: Bottom Right  

**Basic R skills**

    Loading software. 
    Tidyverse  
    Rio
    Run demos from Ch. 3  

**Install software to grab data**

    tidyverse installs 8 separate software packages to perform
    data import, tidying, manipulation, visualisation, and programming
    
**Packages vs. Libraries**

    1) You install the software packages. Usually only once
    2) You call up the software libraries. Do that every time
    
```{r}    
#Installing packages: tidyverse, rio, janitor
#YOU ONLY DO THIS ONCE PER COMPUTER
install.packages("tidyverse")
install.packages("rio") 
install.packages("janitor")
```


    I like the rio package for its easy importing features and janitor for data cleaning
    rio handles more than two dozen formats including tab-separated data (with the extension .tsv), 

    After you install a package on your hard drive, you can call it back up by summoning a library
    Libraries are bits of software you will have to load each time into R to make things run. 
```{r}    
library(tidyverse)
library(rio)
library(janitor)
```

**Now we can use the damned thing**


**Load Data**
```{r}
ArkCensus <- rio::import("https://github.com/profrobwells/CovidFall2020/blob/master/Data/USArk_Counties_Poverty_ACS_16_5YR_DP03_Jan_24.xlsx?raw=true", which = "Poverty")
```

## Basic Commands

     Four Corners Test!
     Number Columns
     Number Rows
     Text, Numeric Data

    How many rows?
    nrow(yourdataset)
```{r}
nrow(ArkCensus)
```

    How many columns?
    ncol(yourdataset)
```{r}
ncol(ArkCensus)
```
    What is in the first five rows?
    head(yourdataset)
```{r}
head(ArkCensus)
```

    Check data types
```{r}
glimpse(ArkCensus)
```
    
**Data Types**   

    chr = character
    dbl = numeric (double-precision floating point number. it has decimals)

---

    Rename columns
```{r}
#Rename several columns at once
colnames(ArkCensus)[1:2] <- c("County", "Income_Up_To_25k") 
```

Check the head of the data table
```{r}
head(ArkCensus)
#Names of your columns
colnames(ArkCensus)
#Another method
#names(ArkCensus)
```

### Exercise #1: Index to commands  
    
    Check the following website and run a command on the ArkCensus data
    https://smach.github.io/R4JournalismBook/HowDoI.html    

```{r}

TYPE YOUR COMMAND here

```

**Software: How to get details and help**

    help(package="dplyr")
    browseVignettes("NameOfPackage”)
    help("NameOfFunction”)
    ??median
    Check to see  what's installed by clicking on "Packages" tab in File Manager, lower right pane


**Summary:** Here is a quick way to view the range of your data   

```{r}
summary(ArkCensus)
```

    Here is a summary just for one column.
    --DATA FRAME$COLUMN NAME
    --ArkCensus$Median_Househ_Income
```{r}
summary(ArkCensus$Median_Househ_Income)
```

### Exercise #2: Summary  
    
      1: Run summary on Income_to25k
      2: Run summary on Pct_Income_to_25k


```{r}

TYPE YOUR COMMAND here

```



**Build a simple summary table by County**   
```{r}
RichPoor <- ArkCensus %>% 
  select(County, Median_Househ_Income) %>% 
  group_by(County) %>% 
  arrange(desc(Median_Househ_Income))
RichPoor
```

**Commands Used**

      select: Select columns by exact name
      group_by: Apply a function to a data frame by group
      arrange: Sort a data frame by one column, descending values


## Filtering

    What is the Median Household Income for United States?
    
```{r}    
ArkCensus %>% 
  select(County, Median_Househ_Income) %>% 
  filter(County =="United States")
```

**Shortcut Commands**
    
      Tab - Autocomplete
      In Console Window (lower left) 
      Control (or Command) + UP arrow - last lines run
      Control (or Command) + Enter - Runs current or selected lines of code in the top left box of RStudio
      Shift + Control (or Command) +P - Reruns previous region code

**What is the Median Household Income for Washington County, Arkansas?**

```{r}    
ArkCensus %>% 
  select(County, Median_Househ_Income) %>% 
  filter(County =="Washington County, Arkansas")
```


### Exercise #3: Filtering Question

    Median Household Income for Benton County, Arkansas
    Median Household Income for Pulaski County, Arkansas
    Median Household Income for Arkansas
    

```{r}

TYPE YOUR COMMAND here

```    
    

**Filter Statewide Median Income**
**Build a table with all counties above that median income**

    
```{r}
AboveIncome <- ArkCensus %>% 
  select(County, Median_Househ_Income) %>% 
  filter(Median_Househ_Income > 42336) %>% 
  arrange(desc(Median_Househ_Income))
AboveIncome
```

**Basics of R**

    In the Console window, type:
```{r}
demo()
```

```{r}
help()
```

```{r}
help.start()
```


### Dplyr 

    select Choose which columns to include.
    filter Filter the data.
    arrange Sort the data, by size for continuous variables, by date, or alphabetically.
    group_by Group the data by a categorical variable.

#Question:

```{r}
AboveIncome <- ArkCensus %>% 
  select(County, Median_Househ_Income) %>% 
  filter(Median_Househ_Income > 42336) %>% 
  arrange(desc(Median_Househ_Income))
AboveIncome
```

### Exercise #4: Filtering. Counties with the lowest quartile in income

```{r}

TYPE YOUR COMMAND here

``` 


**Question: Which county has the lowest percentage of population in this low income bracket?**

    Determine the cutoff for the low income distribution
    
```{r}    
summary(ArkCensus$Pct_Income_to_25k)
```

```{r}
ArkCensus %>% 
  select(County, Pct_Income_to_25k) %>% 
  filter(Pct_Income_to_25k==8.80) %>% 
  arrange(desc(Pct_Income_to_25k))
```

### Exercise #6: Which county has the highest percentage of population in this low income bracket?

```{r}

TYPE YOUR COMMAND here

``` 

## Charts

**Build a basic chart in ggplot using our data**

```{r}
ggplot(AboveIncome, aes(x = County, y = Median_Househ_Income)) + 
  geom_bar(stat = "identity") +
  coord_flip() +    #this makes it a horizontal bar chart instead of vertical
  labs(title = "Communities with high median income", 
       subtitle = "2016",
       caption = "Graphic by Wells",
       y="Place",
       x="Median Income")
```

**Basic chart, adding color**
**fill=Median_Househ_Income**

```{r}
ggplot(AboveIncome, aes(x = County, y = Median_Househ_Income, fill=Median_Househ_Income)) + 
  geom_bar(stat = "identity", show.legend = FALSE) +
  coord_flip() +    #this makes it a horizontal bar chart instead of vertical
  labs(title = "Communities with high median income", 
       subtitle = "2016",
       caption = "Graphic by Wells",
       y="Place",
       x="Median Income")
```

**Basic chart, sorting**
    
    sorting = aes(x = reorder(Geography, Median_Househ_Income), y =      Median_Househ_Income, fill=Median_Househ_Income)) + 

```{r}
ggplot(AboveIncome, aes(x = reorder(County, Median_Househ_Income), y = Median_Househ_Income, fill=Median_Househ_Income)) + 
  geom_bar(stat = "identity", show.legend = FALSE) +
  coord_flip() +    #this makes it a horizontal bar chart instead of vertical
  labs(title = "Communities with high median income", 
       subtitle = "2016",
       caption = "Graphic by Wells",
       y="Place",
       x="Median Income")
```


**Basic chart, add labels**

    labels = geom_text(aes(label = Median_Househ_Income), hjust =        -.1, size = 2.2) +

**Use ggsave for high resolution image**

    ggsave("/Users/rswells/Dropbox/Classes/Data Fall 2020/CovidFall2020/Xx.png",device = "png",width=9,height=6, dpi=800)
    

```{r}
ggplot(AboveIncome, aes(x = reorder(County, Median_Househ_Income), y = Median_Househ_Income, fill=Median_Househ_Income)) + 
  geom_bar(stat = "identity", show.legend = FALSE) +
  geom_text(aes(label = Median_Househ_Income), hjust = -.1, size = 2.2) +
  theme(axis.text.x = element_text(angle = 90, hjust = 1)) +
  coord_flip() +    #this makes it a horizontal bar chart instead of vertical
  labs(title = "Communities with high median income", 
       subtitle = "2016",
       caption = "Graphic by Wells",
       y="Place",
       x="Median Income")

ggsave("/Users/rswells/Dropbox/Classes/Data Fall 2020/CovidFall2020/Xx.png",device = "png",width=9,height=6, dpi=800)
```


### Exercise #7: Build a chart with top 10 counties with lowest median incomes


```{r}

TYPE YOUR COMMAND here

``` 

#--30--

